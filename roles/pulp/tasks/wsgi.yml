---
- name: Install gunicorn
  pip:
    name: gunicorn
    state: present
    virtualenv: '{{ pulp_install_dir }}'
    virtualenv_command: '{{ pulp_python_interpreter }} -m venv'
  when: not pulp_install_via_rpm
  become: true
  become_user: '{{ pulp_user }}'

- name: Install gunicorn via OS package manager
  package:
    name: gunicorn
  when: pulp_install_via_rpm
  become: true

- block:

    - name: Install pulp-api service files
      template:
        src: pulp-api.service.j2
        dest: /etc/systemd/system/pulp-api.service
        owner: root
        group: root
        mode: 0644
      become: true
      notify: Restart pulp-api.service

  when: pulp_install_api_service
